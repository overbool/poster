/*! @overbool/poster v1.0.1 | (c) 2018 Overbool | https://github.com/overbool/poster */
"use strict";var poster=function(){var g=!1,b=768;function m(t,e,i){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"none",n=document.createElement(t);return n.setAttribute(e,i),n.style.display=o,n.width=b,n}function S(t,e,i){var o=t.getContext("2d");t.height=parseInt(e.font.match(/\d+/),10)+20,o.font=e.font,o.fillStyle=e.color;for(var n=0,r=0,l=!(o.textBaseline="top"),a=0;a<i.length;a++)if((n+=o.measureText(i[a]).width)>t.width-60){l=!0,r=a;break}var h=30;l&&(i=i.substring(0,r),h=t.width/2-n/2),g&&(o.strokeStyle="#6fda92",o.strokeRect(0,0,t.width,t.height)),"center"===e.position?(o.textAlign="center",o.fillText(i,t.width/2,0)):"left"===e.position?o.fillText(i,h,0):(o.textAlign="right",o.fillText(i,t.width-h,0))}function A(t,e,i){var o=t.getContext("2d"),n=parseInt(e.font.match(/\d+/),10);g&&(o.strokeStyle="#6fda92",o.strokeRect(0,0,t.width,t.height)),o.font=e.font,o.fillStyle=e.color,o.textBaseline="top";var r=0;r=(o.textAlign="center")===e.position?t.width/2:"left"===e.position?(o.textAlign="left",60):(o.textAlign="right",t.width-60);for(var l=0,a=0,h=0,c=0;c<i.length;c++)(l+=o.measureText(i[c]).width)>t.width-120&&(o.fillText(i.substring(a,c),r,h),h+=n*e.lineHeight,l=0,a=c),c===i.length-1&&o.fillText(i.substring(a,c+1),r,h)}return{init:function(o){var n=document.querySelector(o.selector);n.style.border="1px solid #f0f0f0";var r=m("div","id","wrapper"),l=m("canvas","id","canvas","block"),a=m("canvas","id","author"),h=m("canvas","id","day"),c=m("canvas","id","date"),g=m("canvas","id","title"),d=m("canvas","id","content"),s=m("canvas","id","logo"),f=m("canvas","id","description"),t=m("canvas","id","qrcode"),p=m("canvas","id","qrcode-desc");!function(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];i.forEach(function(t){e.appendChild(t)})}(r,l,a,h,c,g,d,s,f,t,p),n.appendChild(r),S(a,{font:"italic 45px Arial",color:"rgba(255, 255, 255, 1)",position:"left"},o.author);var e=new Date;S(h,{font:"italic bold 70px Arial",color:"rgba(255, 255, 255, 1)",position:"right"},e.getDate()),S(c,{font:"italic 30px Arial",color:"rgba(255, 255, 255, 1)",position:"right"},e.getFullYear()+" / "+(e.getMonth()+1));var i={font:"bold 50px Arial",color:"rgba(66, 66, 66, 1)",position:"center"};i.font=o.titleStyle&&o.titleStyle.font||i.font,i.color=o.titleStyle&&o.titleStyle.color||i.color,i.position=o.titleStyle&&o.titleStyle.position||i.position,S(g,i,o.title);var w={font:"24px Arial",lineHeight:1.5,position:"center",color:"rgba(88, 88, 88, 1)"};w.font=o.contentStyle&&o.contentStyle.font||w.font,w.color=o.contentStyle&&o.contentStyle.color||w.color,w.lineHeight=o.contentStyle&&o.contentStyle.lineHeight||w.lineHeight,w.position=o.contentStyle&&o.contentStyle.position||w.position,A(d,w,o.content);var v={font:"bold 40px Roboto Slab",position:"center",color:"rgba(0, 0, 25, 1)"};v.color=o.logoStyle&&o.logoStyle.color||v.color,s.width*=.7,S(s,v,o.logo),f.width*=.7777777,A(f,{font:"24px Arial",color:"rgba(180, 180, 180, 1)",lineHeight:1.1,position:"center"},o.description),p.width*=.7,S(p,{font:"28px Arial",color:"rgba(88, 88, 88, 1)",lineHeight:1.1,position:"center"},o.qrcodeDesc);var y=new Image,u=new Image;l.width=b,l.height=1168,u.crossOrigin="Anonymous",y.crossOrigin="Anonymous",u.src=o.qrcode,u.onload=function(){y.src=o.banner,y.onload=x};var x=function(){var t=l.getContext("2d");t.fillStyle="rgba(255, 255, 255, 1)",t.fillRect(0,0,l.width,l.height),t.drawImage(y,0,0,l.width,l.height/2),t.drawImage(a,15,15),t.drawImage(h,0,l.height/2-120),t.drawImage(c,0,l.height/2-50),t.drawImage(g,0,l.height/2+75),t.drawImage(d,0,l.height/2+185),t.drawImage(s,0,l.height-s.height-25),t.drawImage(f,0,l.height-f.height+20),t.drawImage(p,0,l.height-f.height-25),t.drawImage(u,.7*l.width+20,l.height-f.height-30,.2*l.width,.2*l.width),t.strokeStyle="rgba(122, 122, 122, 0.5)",t.setLineDash([5,6]),t.moveTo(0,l.height/2+365),t.lineTo(768,l.height/2+365),t.stroke();var e=new Image;e.src=l.toDataURL("image/png");var i=o.radio||.7;e.width=b*i,e.height=1168*i,t.clearRect(0,0,l.width,l.height),l.style.display="none",n.appendChild(e),n.removeChild(r),o.callback&&o.callback(n)}}}}();